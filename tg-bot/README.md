# AI Stock Bot - Telegram Bot

Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è AI Stock Bot - —Å–∏—Å—Ç–µ–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ AI –º–æ–¥–µ–ª—è–º–∏, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ø–ª–∞—Ç–µ–∂–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å—Ç–æ–∫–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js 18+
- Telegram Bot Token (–æ—Ç [@BotFather](https://t.me/BotFather))
- –ó–∞–ø—É—â–µ–Ω–Ω—ã–π Backend API
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### –ß–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
docker-compose --profile bot up -d
```

#### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
cd tg-bot
npm install
cp .env.example .env
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env
npm start
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Telegram Bot

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
tg-bot/
‚îú‚îÄ‚îÄ index.js                # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ backendApiService.js # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Backend API
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ README.md
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### Main Bot (index.js)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Bot API
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏
- Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ callback queries
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API

#### BackendApiService
- HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Backend API
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- Fallback –Ω–∞ –¥–µ–º–æ —Ä–µ–∂–∏–º

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
```bash
# Telegram Bot
TELEGRAM_TOKEN=your_telegram_bot_token_from_botfather

# Backend API
BACKEND_API_URL=http://localhost:3000/api
```

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
```bash
# Timeouts
BACKEND_API_TIMEOUT=120000

# Demo mode
DEMO_MODE=false

# Logging
LOG_LEVEL=info
```

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `.env.example`

## üìã –ö–æ–º–∞–Ω–¥—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```
/start    - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/help     - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞
/mystocks - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å—Ç–æ–∫–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ 123RF
/balance  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
/buy      - –ö—É–ø–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã)
```

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–í–≤–æ–¥**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ø—Ä–æ–º–ø—Ç–∞ (–¥–æ 1000 —Å–∏–º–≤–æ–ª–æ–≤)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞**: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ Backend API
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- **–î–µ–π—Å—Ç–≤–∏—è**: Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å—Ç–æ–∫–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **–ü–æ–∫—É–ø–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YooMoney —á–µ—Ä–µ–∑ Backend
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ –Ω—É–ª–µ–≤–æ–º –±–∞–ª–∞–Ω—Å–µ

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–æ–∫–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **123RF Integration**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ FTP —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–∏—Å–æ–º
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- **–ó–∞–≥—Ä—É–∑–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API

### API Endpoints –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–æ—Ç–æ–º

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```javascript
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /api/users
{
  externalId: telegramUserId,
  externalSystem: "telegram",
  profile: { username, firstName, lastName, language }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/users/external/{telegramUserId}/telegram

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
GET /api/users/{userId}/stats
```

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```javascript
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
POST /api/images/generate
{
  prompt: "user prompt",
  userId: userId,
  userExternalId: telegramUserId,
  options: { model: "juggernaut-pro-flux" }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞)
GET /api/images/{imageId}/file?userId={userId}
```

#### –ü–ª–∞—Ç–µ–∂–∏
```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
POST /api/payments/create
{
  userId: userId,
  telegramId: telegramUserId,
  planId: "plan_100_images",
  returnUrl: "https://t.me/your_bot"
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤
GET /api/payments/plans

// –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
GET /api/payments/history/{userId}
```

#### –°—Ç–æ–∫–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
GET /api/users/{userId}/stock-services

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ 123RF
PUT /api/users/{userId}/stock-services/123rf
{
  enabled: true,
  credentials: { username, password },
  settings: { ftpHost, ftpPath }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ 123RF
POST /api/upload/123rf
{
  imageId: imageId,
  userId: userId,
  title: "Image title",
  description: "Image description",
  keywords: ["keyword1", "keyword2"],
  category: "Digital Art"
}
```

## üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start
    ‚Üì
–ë–æ—Ç ‚Üí –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Backend
    ‚Üì
–ë–æ—Ç ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—Ç–æ–∫–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
    ‚Üì
–ë–æ—Ç ‚Üí –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ + –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    ‚Üì
–ë–æ—Ç ‚Üí –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞
    ‚Üì
–ë–æ—Ç ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ Backend
    ‚Üì
–ë–æ—Ç ‚Üí –ó–∞–ø—Ä–æ—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫ Backend API
    ‚Üì
Backend ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä
    ‚Üì
–ë–æ—Ç ‚Üí –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    ‚Üì
–ë–æ—Ç ‚Üí Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å—Ç–æ–∫–∏
```

### 3. –ü–æ–∫—É–ø–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /buy –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å"
    ‚Üì
–ë–æ—Ç ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –æ—Ç Backend
    ‚Üì
–ë–æ—Ç ‚Üí Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –ø–ª–∞–Ω–∞–º–∏
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –í—ã–±–æ—Ä –ø–ª–∞–Ω–∞
    ‚Üì
–ë–æ—Ç ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ Backend
    ‚Üì
–ë–æ—Ç ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É YooMoney
    ‚Üì
YooMoney ‚Üí Webhook –≤ Backend –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
    ‚Üì
Backend ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram —á–µ—Ä–µ–∑ Bot API
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ 123RF
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /mystocks
    ‚Üì
–ë–æ—Ç ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Ç Backend
    ‚Üì
–ë–æ—Ç ‚Üí Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí "–ü—Ä–∏–≤—è–∑–∞—Ç—å 123RF"
    ‚Üì
–ë–æ—Ç ‚Üí –ó–∞–ø—Ä–æ—Å –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è (–º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π –¥–∏–∞–ª–æ–≥)
    ‚Üì
–ë–æ—Ç ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ Backend
    ‚Üì
Backend ‚Üí –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    ‚Üì
–ë–æ—Ç ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```javascript
// –ü—Ä–æ–º–ø—Ç—ã
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 1000 —Å–∏–º–≤–æ–ª–æ–≤
- –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

// –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ 123RF
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Backend
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏–∏ (–≤—Ä–µ–º–µ–Ω–Ω–æ)
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
```javascript
// –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
const userSessions = new Map();

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Å—Å–∏–∏
{
  userId: "telegram_user_id",
  step: "awaiting_123rf_username",
  data: { /* –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ */ },
  timestamp: Date.now()
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
setInterval(() => cleanExpiredSessions(), 300000); // 5 –º–∏–Ω—É—Ç
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```javascript
// API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
if (apiError) {
  if (DEMO_MODE) {
    return sendDemoImage();
  } else {
    return sendErrorMessage("–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
  }
}

// –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å
if (balance <= 0) {
  return sendBalanceMessage();
}

// –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
if (promptTooLong) {
  return sendMessage("–û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å. 1000 —Å–∏–º–≤–æ–ª–æ–≤)");
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```javascript
// –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logger.info('User action', {
  userId: telegramUserId,
  action: 'generate_image',
  prompt: prompt.substring(0, 100),
  timestamp: new Date().toISOString()
});

// –û—à–∏–±–∫–∏ API
logger.error('Backend API error', {
  endpoint: '/api/images/generate',
  status: response.status,
  error: response.data,
  userId: telegramUserId
});
```

### Health Check
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Backend API
async function checkBackendHealth() {
  try {
    const response = await backendApi.get('/health');
    return response.status === 200;
  } catch (error) {
    logger.warn('Backend API unavailable', { error: error.message });
    return false;
  }
}

// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
setInterval(checkBackendHealth, 60000); // –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Backend API
cd backend && npm run dev

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Telegram Bot
cd tg-bot && npm start

# 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã
/start - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
/help - —Å–ø—Ä–∞–≤–∫–∞
/balance - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
/buy - –ø–æ–∫—É–ø–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
/mystocks - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ 123RF

# 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
–û—Ç–ø—Ä–∞–≤—å—Ç–µ: "Beautiful sunset over mountains"
```

### –î–µ–º–æ —Ä–µ–∂–∏–º
```bash
# –ó–∞–ø—É—Å–∫ –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ (–±–µ–∑ Backend API)
DEMO_MODE=true npm start

# –ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "DEMO_MODE=true" >> .env
npm start
```

### –û—Ç–ª–∞–¥–∫–∞
```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOG_LEVEL=debug npm start

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ Docker
docker-compose logs -f tg-bot
```

## üîÑ Workflow –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
```javascript
bot.on('message', async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const text = msg.text;

  try {
    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await backendApi.initializeUser(userId, msg.from);
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
    const balance = await backendApi.getUserBalance(user.id);
    if (balance <= 0) {
      return sendBalanceMessage(chatId);
    }
    
    // 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞
    if (text.length > 1000) {
      return bot.sendMessage(chatId, '–û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ');
    }
    
    // 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const image = await backendApi.generateImage(text, user.id, userId);
    
    // 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    await sendImageWithButtons(chatId, image);
    
  } catch (error) {
    logger.error('Message processing error', { error, userId });
    await sendErrorMessage(chatId);
  }
});
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ callback queries
```javascript
bot.on('callback_query', async (query) => {
  const chatId = query.message.chat.id;
  const userId = query.from.id;
  const data = JSON.parse(query.data);

  switch (data.action) {
    case 'upload_123rf':
      await handle123RFUpload(chatId, userId, data.imageId);
      break;
    case 'buy_plan':
      await handlePlanPurchase(chatId, userId, data.planId);
      break;
    case 'configure_123rf':
      await handleStockConfiguration(chatId, userId);
      break;
  }
});
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```javascript
// –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const imageStream = await backendApi.getImageStream(imageId);
await bot.sendPhoto(chatId, imageStream);

// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è callback –æ–ø–µ—Ä–∞—Ü–∏–π
const imageCache = new Map();
imageCache.set(imageId, { userId, metadata });

// –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
process.on('memoryUsage', () => {
  if (imageCache.size > 1000) {
    imageCache.clear();
  }
});
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
```javascript
// Telegram API limits
- –ú–∞–∫—Å–∏–º—É–º 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: –¥–æ 10MB
- –î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π: –¥–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤

// –ù–∞—à–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ü—Ä–æ–º–ø—Ç: –¥–æ 1000 —Å–∏–º–≤–æ–ª–æ–≤
- –¢–∞–π–º–∞—É—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: 2 –º–∏–Ω—É—Ç—ã
- –°–µ—Å—Å–∏–∏: –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
```

## üê≥ Docker

### Dockerfile
```dockerfile
FROM node:18-alpine

WORKDIR /app

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ package files
COPY package*.json ./

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN npm ci --only=production

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
COPY . .

# –°–æ–∑–¥–∞–Ω–∏–µ non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001
USER nodejs

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
CMD ["npm", "start"]
```

### Docker Compose –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```yaml
tg-bot:
  build: ./tg-bot
  environment:
    - TELEGRAM_TOKEN=${TELEGRAM_TOKEN}
    - BACKEND_API_URL=http://backend:3000/api
    - DEMO_MODE=${DEMO_MODE:-false}
  depends_on:
    - backend
  restart: unless-stopped
  profiles:
    - bot
    - full
```

## üöß Roadmap

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–∫–æ–≤—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π —Å YooMoney
- Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –î–µ–º–æ —Ä–µ–∂–∏–º —Å fallback
- –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏

### –í –ø–ª–∞–Ω–∞—Ö üîÑ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç–æ–∫–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–≥—Ä—É–∑–æ–∫
- –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## ü§ù Contributing

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch
3. –°–ª–µ–¥—É–π—Ç–µ code style –ø—Ä–æ–µ–∫—Ç–∞
4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å Backend API
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ Telegram Bot:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs tg-bot`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Backend API: `curl http://localhost:3000/api/health`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `TELEGRAM_TOKEN`
4. –ò–∑—É—á–∏—Ç–µ [–æ–±—â—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é](../doc/README.md)
5. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ GitHub
